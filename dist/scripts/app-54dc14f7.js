"use strict";angular.module("customDirectives",[]).directive("whenScrolled",function(){return function(e,r,a){var n=r[0];r.bind("scroll",function(){n.scrollTop+n.offsetHeight>=n.scrollHeight&&e.$apply(a.whenScrolled)})}}).directive("onErrorSrc",function(){return{link:function(e,r){r.bind("error",function(){e.person.avatar=null,e.$apply()})}}}),angular.module("processingModule",["dataModule"]).factory("userService",["$q","$filter","dataService",function(e,r,a){function n(){var r=a.getLogs(),n=a.getUsers();e.all([r,n]).then(function(e){t=e[1].data,i=e[0].data,s()})}function s(){var e,r;for(r=t.length-1;r>=0;r--)e=t[r].id,l[e]=t[r],l[e].summary={impressions:0,conversions:0,revenue:0,chartData:{start:null,end:null,labels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}};o()}function o(){var e,r,a;for(a=i.length-1;a>=0;a--)if(e=i[a].user_id,r=l[e].summary,i[a].revenue>0){r.revenue+=i[a].revenue,r.conversions++;var n=i[a].time.replace(/\s/g,"T");n=new Date(n);var s=n.getDate();r.chartData.data[0][Number(s)]++;var o=n.getTime();(!r.start||r.start>o)&&(r.start=o,r.end=o+2592e6)}else r.impressions++;c.resolve(l)}var t,i,l={},c=e.defer(),u=c.promise;return n(),{getUsers:function(){return u}}}]),angular.module("dataModule",[]).factory("dataService",["$http","$q","$log",function(e,r,a){return{getUsers:function(){var n=r.defer(),s=n.promise;return e.get("app/components/dataServices/rawData/users.json").then(function(e){n.resolve(e)})["catch"](function(e){a.error(e),n.resolve(null)}),s},getLogs:function(){var n=r.defer(),s=n.promise;return e.get("app/components/dataServices/rawData/logs.json").then(function(e){n.resolve(e)})["catch"](function(e){a.error(e),n.resolve(null)}),s}}}]),angular.module("tuneApp",["ngTouch","ngRoute","ui.bootstrap","chart.js","processingModule","customDirectives"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("tuneApp").controller("MainCtrl",["$scope","userService",function(e,r){r.getUsers().then(function(r){e.allPeople=r,e.people=[],e.loadMore()});var a=1;e.loadMore=function(){for(var r=1;20>r;r++)a<Object.keys(e.allPeople).length&&(e.people.push(e.allPeople[a]),a++)},e.colours=["#000"],e.options={animation:!1,bezierCurve:!1,pointDot:!1,scaleGridLineColor:"rgba(0,0,0,0)",strokeColor:"rgba(0,0,0,0)",scaleShowGridLines:!1,scaleShowLabels:!1,showScale:!1,showTooltips:!1,datasetFill:!1,datasetStrokeWidth:1.5}}]),angular.module("tuneApp").run(["$templateCache",function(e){e.put("app/main/main.html",'<div class="container"><div id="fixed" class="row people" when-scrolled="loadMore()"><div class="col-sm-6 col-md-4 person" ng-repeat="person in people track by $index"><div class="thumbnail"><div class="header"><div class="avatar"><img ng-show="person.avatar" ng-src="{{person.avatar}}" on-error-src=""><div ng-show="!person.avatar" class="blank"><h3>{{person.name.charAt(0)}}</h3></div></div><div class="caption"><h3>{{person.name}}</h3><p>{{person.occupation}}</p></div></div><div class="graph"><canvas height="100" id="line" class="chart chart-line" data="person.summary.chartData.data" labels="person.summary.chartData.labels" options="options" colours="colours"></canvas><span>Conversions {{person.summary.start | date: \'M/d\'}} - {{person.summary.end | date: \'M/d\'}}</span></div><div class="summary"><p><span class="impressions">{{person.summary.impressions}}</span><br>impressions</p><p><span class="conversions">{{person.summary.conversions}}</span><br>conversions</p><p><span class="revenue">${{person.summary.revenue | number:0 }}</span></p></div></div></div></div></div>')}]);